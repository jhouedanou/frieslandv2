import 'package:json_annotation/json_annotation.dart';
import '../../domain/entities/visite.dart';

part 'visite_model.g.dart';

@JsonSerializable()
class VisiteModel extends Visite {
  const VisiteModel({
    required super.visiteId,
    required super.pdvId,
    required super.nomDuPdv,
    required super.dateVisite,
    required super.commercial,
    required super.latitude,
    required super.longitude,
    required super.distanceAuPdv,
    required super.mdm,
    super.imagePath,
    required super.geofenceValide,
    required super.precisionGps,
    required super.evapPresent,
    super.evapBrGoldPresent,
    super.evapBr160gPresent,
    super.evapBrb160gPresent,
    super.evapBr400gPresent,
    super.evapBrb400gPresent,
    super.evapPearl400gPresent,
    required super.evapPrixRespectes,
    required super.impPresent,
    super.impBr400gPresent,
    super.impBr900gPresent,
    super.impBr25kgPresent,
    super.impBr375gPresent,
    super.impBrb400gPresent,
    super.impBr20gPresent,
    super.impBrb25gPresent,
    required super.impPrixRespectes,
    required super.scmPresent,
    super.scmBr1kgPresent,
    super.scmBrb1kgPresent,
    super.scmBrb397gPresent,
    super.scmBr397gPresent,
    super.scmPearl1kgPresent,
    required super.scmPrixRespectes,
    required super.uhtPresent,
    required super.uhtPrixRespectes,
    required super.yoghurtPresent,
    required super.yoghurtPrixRespectes,
  });

  factory VisiteModel.fromJson(Map<String, dynamic> json) => _$VisiteModelFromJson(json);
  Map<String, dynamic> toJson() => _$VisiteModelToJson(this);

  factory VisiteModel.fromFirestore(Map<String, dynamic> doc) {
    return VisiteModel(
      visiteId: doc['visite_id'] ?? '',
      pdvId: doc['pdv_id'] ?? '',
      nomDuPdv: doc['nom_du_pdv'] ?? '',
      dateVisite: DateTime.fromMillisecondsSinceEpoch(doc['date_visite'] ?? 0),
      commercial: doc['commercial'] ?? '',
      latitude: (doc['latitude'] ?? 0.0).toDouble(),
      longitude: (doc['longitude'] ?? 0.0).toDouble(),
      distanceAuPdv: (doc['distance_au_pdv'] ?? 0.0).toDouble(),
      mdm: doc['mdm'] ?? '',
      imagePath: doc['image_path'],
      geofenceValide: doc['geofence_valide'] ?? false,
      precisionGps: (doc['precision_gps'] ?? 0.0).toDouble(),
      evapPresent: doc['evap_present'] ?? false,
      evapBrGoldPresent: doc['evap_br_gold_present'],
      evapBr160gPresent: doc['evap_br_160g_present'],
      evapBrb160gPresent: doc['evap_brb_160g_present'],
      evapBr400gPresent: doc['evap_br_400g_present'],
      evapBrb400gPresent: doc['evap_brb_400g_present'],
      evapPearl400gPresent: doc['evap_pearl_400g_present'],
      evapPrixRespectes: doc['evap_prix_respectes'] ?? false,
      impPresent: doc['imp_present'] ?? false,
      impBr400gPresent: doc['imp_br_400g_present'],
      impBr900gPresent: doc['imp_br_900g_present'],
      impBr25kgPresent: doc['imp_br_2_5kg_present'],
      impBr375gPresent: doc['imp_br_375g_present'],
      impBrb400gPresent: doc['imp_brb_400g_present'],
      impBr20gPresent: doc['imp_br_20g_present'],
      impBrb25gPresent: doc['imp_brb_25g_present'],
      impPrixRespectes: doc['imp_prix_respectes'] ?? false,
      scmPresent: doc['scm_present'] ?? false,
      scmBr1kgPresent: doc['scm_br_1kg_present'],
      scmBrb1kgPresent: doc['scm_brb_1kg_present'],
      scmBrb397gPresent: doc['scm_brb_397g_present'],
      scmBr397gPresent: doc['scm_br_397g_present'],
      scmPearl1kgPresent: doc['scm_pearl_1kg_present'],
      scmPrixRespectes: doc['scm_prix_respectes'] ?? false,
      uhtPresent: doc['uht_present'] ?? false,
      uhtPrixRespectes: doc['uht_prix_respectes'] ?? false,
      yoghurtPresent: doc['yoghurt_present'] ?? false,
      yoghurtPrixRespectes: doc['yoghurt_prix_respectes'] ?? false,
    );
  }

  Map<String, dynamic> toFirestore() {
    return {
      'visite_id': visiteId,
      'pdv_id': pdvId,
      'nom_du_pdv': nomDuPdv,
      'date_visite': dateVisite.millisecondsSinceEpoch,
      'commercial': commercial,
      'latitude': latitude,
      'longitude': longitude,
      'distance_au_pdv': distanceAuPdv,
      'mdm': mdm,
      'image_path': imagePath,
      'geofence_valide': geofenceValide,
      'precision_gps': precisionGps,
      'evap_present': evapPresent,
      'evap_br_gold_present': evapBrGoldPresent,
      'evap_br_160g_present': evapBr160gPresent,
      'evap_brb_160g_present': evapBrb160gPresent,
      'evap_br_400g_present': evapBr400gPresent,
      'evap_brb_400g_present': evapBrb400gPresent,
      'evap_pearl_400g_present': evapPearl400gPresent,
      'evap_prix_respectes': evapPrixRespectes,
      'imp_present': impPresent,
      'imp_br_400g_present': impBr400gPresent,
      'imp_br_900g_present': impBr900gPresent,
      'imp_br_2_5kg_present': impBr25kgPresent,
      'imp_br_375g_present': impBr375gPresent,
      'imp_brb_400g_present': impBrb400gPresent,
      'imp_br_20g_present': impBr20gPresent,
      'imp_brb_25g_present': impBrb25gPresent,
      'imp_prix_respectes': impPrixRespectes,
      'scm_present': scmPresent,
      'scm_br_1kg_present': scmBr1kgPresent,
      'scm_brb_1kg_present': scmBrb1kgPresent,
      'scm_brb_397g_present': scmBrb397gPresent,
      'scm_br_397g_present': scmBr397gPresent,
      'scm_pearl_1kg_present': scmPearl1kgPresent,
      'scm_prix_respectes': scmPrixRespectes,
      'uht_present': uhtPresent,
      'uht_prix_respectes': uhtPrixRespectes,
      'yoghurt_present': yoghurtPresent,
      'yoghurt_prix_respectes': yoghurtPrixRespectes,
    };
  }
}